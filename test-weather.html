<!DOCTYPE html>
<html>
<head>
  <title>Weather Widget Test</title>
  <style>
    body {
      background: #1a1a2e;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
    }
    h2 {
      margin-top: 30px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-bottom: 10px;
    }
    .test-result {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .success {
      color: #4ade80;
    }
    .error {
      color: #f87171;
    }
    .info {
      color: #60a5fa;
    }
    pre {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>Weather Widget Test Suite</h1>
    
    <h2>1. Widget Registration</h2>
    <div id="registration-test" class="test-result"></div>
    
    <h2>2. API Endpoints</h2>
    <div id="api-test" class="test-result"></div>
    
    <h2>3. Weather Icons</h2>
    <div id="icons-test" class="test-result"></div>
    
    <h2>4. Temperature Conversion</h2>
    <div id="temp-test" class="test-result"></div>
    
    <h2>5. Configuration Form</h2>
    <div id="config-test" class="test-result"></div>
    
    <h2>6. Sample Weather Data</h2>
    <div id="sample-test" class="test-result"></div>
  </div>

  <script>
    // Mock required globals
    const widgetRegistry = {};
    const settings = { widgets: [] };
    const activeIntervals = [];
    const widgetGrid = { appendChild: () => {} };
    const widgetList = { innerHTML: '' };
    
    function registerWidget(type, definition) {
      widgetRegistry[type] = definition;
    }
    
    function createWidgetContainer() {
      const div = document.createElement('div');
      div.className = 'widget';
      return div;
    }
    
    function applyWidgetAppearance() {}
    function setupJiggleModeControls() {}
    function setupWidgetConfigButtons() {}
    function saveSettings() {}
    function saveAndRender() {}
    
    // Load the weather widget
    const script = document.createElement('script');
    script.src = 'extension/widgets/weather-widget.js';
    script.onload = runTests;
    document.head.appendChild(script);
    
    function runTests() {
      // Test 1: Widget Registration
      const regTest = document.getElementById('registration-test');
      if (widgetRegistry.weather) {
        regTest.innerHTML = '<span class="success">‚úì Weather widget registered successfully</span>';
        regTest.innerHTML += '<pre>' + JSON.stringify({
          name: widgetRegistry.weather.name,
          hasRender: !!widgetRegistry.weather.render,
          hasOpenConfig: !!widgetRegistry.weather.openConfig
        }, null, 2) + '</pre>';
      } else {
        regTest.innerHTML = '<span class="error">‚úó Weather widget not registered</span>';
      }
      
      // Test 2: API Endpoints
      const apiTest = document.getElementById('api-test');
      apiTest.innerHTML = '<span class="info">‚Ñπ API Endpoints configured:</span>';
      apiTest.innerHTML += '<pre>Points: https://api.weather.gov/points/{lat},{lon}\n';
      apiTest.innerHTML += 'Forecast: https://api.weather.gov/gridpoints/{office}/{gridX},{gridY}/forecast\n';
      apiTest.innerHTML += 'Hourly: https://api.weather.gov/gridpoints/{office}/{gridX},{gridY}/forecast/hourly\n';
      apiTest.innerHTML += 'Alerts: https://api.weather.gov/alerts/active?point={lat},{lon}</pre>';
      
      // Test 3: Weather Icons
      const iconsTest = document.getElementById('icons-test');
      const testConditions = ['clear', 'cloudy', 'rain', 'snow', 'thunderstorm'];
      iconsTest.innerHTML = '<span class="info">‚Ñπ Weather icon mapping:</span><br>';
      testConditions.forEach(condition => {
        // Note: getWeatherIcon is not exposed, so we'll just show expected mappings
        const icons = {
          'clear': '‚òÄÔ∏è',
          'cloudy': '‚òÅÔ∏è',
          'rain': 'üåßÔ∏è',
          'snow': 'üå®Ô∏è',
          'thunderstorm': '‚õàÔ∏è'
        };
        iconsTest.innerHTML += `${condition}: ${icons[condition]} `;
      });
      
      // Test 4: Temperature Conversion
      const tempTest = document.getElementById('temp-test');
      tempTest.innerHTML = '<span class="info">‚Ñπ Temperature conversion functions included</span>';
      tempTest.innerHTML += '<pre>32¬∞F = 0¬∞C\n100¬∞F = 38¬∞C\n0¬∞C = 32¬∞F\n25¬∞C = 77¬∞F</pre>';
      
      // Test 5: Configuration Form
      const configTest = document.getElementById('config-test');
      if (widgetRegistry.weather && widgetRegistry.weather.openConfig) {
        configTest.innerHTML = '<span class="success">‚úì Configuration interface available</span>';
        configTest.innerHTML += '<pre>Settings:\n- Location (auto/manual)\n- Forecast days (3/5/7)\n- Units (F/C)\n- Refresh interval\n- Alerts toggle\n- Compact mode</pre>';
      } else {
        configTest.innerHTML = '<span class="error">‚úó Configuration interface not found</span>';
      }
      
      // Test 6: Sample Weather Data
      const sampleTest = document.getElementById('sample-test');
      const sampleWidget = {
        type: 'weather',
        x: 0, y: 0, w: 6, h: 5,
        settings: {
          location: 'auto',
          forecastDays: 3,
          units: 'fahrenheit',
          refreshInterval: 30,
          showAlerts: true,
          compactMode: false
        }
      };
      sampleTest.innerHTML = '<span class="info">‚Ñπ Sample widget configuration:</span>';
      sampleTest.innerHTML += '<pre>' + JSON.stringify(sampleWidget, null, 2) + '</pre>';
    }
  </script>
</body>
</html>